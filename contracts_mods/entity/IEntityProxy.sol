// SPDX-License-Identifier: MIT
// Compatible with OpenZeppelin Contracts ^5.0.0
pragma solidity ^0.8.24;

import {ModuleVersion} from '../modules/IModule.sol';

/**
 * Entity proxy is used for upgradeable entity components that are generated by a cloning or registration process.
 * The proxy itself can never be upgraded; but its implementation is upgradeable through the factory used to 
 * generate the implementation. An entity proxy also has the option of always using the latest implementation
 * from the latest entity factory module.
 */
interface IEntityProxy {

    event ProxyImplementationChanged(address indexed newImpl, ModuleVersion version);


    function staticLoop(address tgt, bytes calldata data) external returns (bytes memory);

    /**
     * @dev Set the implementation of the proxy. This can only be called by the registry that 
     * creates or clones the proxy. This is an immutable address set on the proxy at creation.
     */
    function setImplementation(address _newImplementation) external;

    /**
     * @dev Get the version of the implementation.
     */
    function implementationVersion() external view returns (ModuleVersion memory);

    /**
     * @dev Set the proxy to always use the latest implementation. This is useful for testing
     * and development, but should be used cautiously in production.
     */
    function setAutomaticUpgrade(bool _alwaysUseLatest) external;

    /**
     * @dev Get the current state of the automatic upgrade flag.
     */
    function isAutomaticUpgrade() external view returns (bool);
}